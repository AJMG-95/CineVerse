<div
  class="card group relative bg-base-100 image-full no-overlay w-full max-w-sm overflow-hidden rounded-2xl shadow-sm transition cursor-pointer hover:shadow-md hover:shadow-primary focus-within:shadow-md"
  (click)="onClick()" role="button" tabindex="0" (keydown.enter)="onClick()" (keydown.space)="onClick()">
  <figure class="aspect-[2/3]">
    <img [src]="tv().poster_path | tmdbImg : 'w500'" alt="Poster"
      class="h-full w-full object-cover transition duration-300" [class.opacity-60]="isActive()"
      [class.scale-[1.02]]="!isActive()" [class.group-hover:scale-[1.04]]="true" />
  </figure>

  <div class="card-body bg-transparent flex flex-col justify-between">
    <h2 class="card-title drop-shadow-sm">
      {{ tv().name }}
    </h2>

    <div class="mt-1 flex flex-wrap gap-2 justify-between">
      <!-- Popularidad -->
      <span class="badge badge-ghost gap-1">
        <span aria-hidden="true">ðŸ”¥</span>
        {{ tv().popularity | km : 1 }}
      </span>

      <!-- ValoraciÃ³n -->
      <span class="badge badge-ghost gap-1">
        <span aria-hidden="true">â˜…</span>
        {{ tv().vote_average | number : '1.1-1' }}
        <span class="opacity-70">({{ tv().vote_count | km : 1 }})</span>
      </span>
    </div>
  </div>

  <!-- GLASS solo si estÃ¡ activa -->
  <div class="absolute inset-0 transition-opacity duration-200" [class]="isActive() ? 'opacity-100' : 'opacity-0'">
    <div class="glass h-full w-full dark:bg-neutral-900/60 backdrop-blur-md p-4">
      @if (detailsRes.value(); as d) {
      <section class="flex h-full flex-col justify-between">
        <div>
          <!-- En TV tambiÃ©n existe 'tagline' -->
          <p class="text-md font-semibold text-neutral-100 mb-4">
            {{ d.tagline || ' ' }}
          </p>

          <!-- GÃ©neros -->
          @if (d.genres) {
          <div class="mt-3 flex flex-wrap gap-2">
            @for (g of d.genres; track g.id) {
            <span class="badge badge-info badge-sm text-sm">
              {{ g.name }}
            </span>
            }
          </div>
          }
        </div>

        <div class="w-full">
          <div class="flex flex-row justify-between mb-3">
            <button class="min-w-[106px] btn btn-outline btn-accent bg-accent/20 w-fit text-neutral-100" type="button"
              (click)="toggleWatched($event)">
              <i class="pi" [ngClass]="isInWatched() ? 'pi-eye' : 'pi-eye-slash'"></i>
              <span>{{ isInWatched() ? 'Vista' : 'No vista' }} </span>
            </button>

            <button class="btn btn-outline btn-accent bg-accent/20 w-fit text-neutral-100" type="button"
              (click)="toggleFavorite($event)" title="Favorito">
              <i class="pi" [ngClass]="isInFavorites() ? 'pi-star-fill' : 'pi-star'"></i>
            </button>

            <button class="btn btn-outline btn-accent bg-accent/20 w-fit text-neutral-100" type="button"
              (click)="toggleList($event)" title="Lista">
              <i class="pi" [ngClass]="isInList() ? 'pi-bookmark-fill' : 'pi-bookmark'"></i>
            </button>
          </div>

          <button class="btn btn-outline btn-accent bg-accent/20 w-full text-neutral-100" type="button"
            (click)="goToDetail($event)">
            Ver mÃ¡s
          </button>

          <p class="text-end text-xs opacity-80 text-neutral-100 mt-4">
            Primera emisiÃ³n: {{ d.first_air_date }}
          </p>
        </div>
      </section>
      }
    </div>
  </div>
</div>
