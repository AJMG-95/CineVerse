<div
  class="card group relative bg-base-100 image-full no-overlay w-full max-w-sm overflow-hidden rounded-2xl shadow-sm transition cursor-pointer hover:shadow-md hover:shadow-primary focus-within:shadow-md"
  (click)="onClick()"
  role="button"
  tabindex="0"
  (keydown.enter)="onClick()"
  (keydown.space)="onClick()"
>
  <figure class="aspect-[2/3]">
    <img
      [src]="movie().poster_path | tmdbImg : 'w500'"
      alt="Poster"
      class="h-full w-full object-cover transition duration-300"
      [class.opacity-60]="isActive()"
      [class.scale-[1.02]]="!isActive()"
      [class.group-hover:scale-[1.04]]="true"
    />
  </figure>

  <div class="card-body bg-transparent flex flex-col justify-between">
    <h2 class="card-title drop-shadow-sm">
      {{ movie().title }}
    </h2>

    <div class="mt-1 flex flex-wrap gap-2 justify-between">
      <!-- Popularidad -->
      <span class="badge badge-ghost gap-1">
        <span aria-hidden="true">ðŸ”¥</span>
        {{ movie().popularity | km : 1 }}
      </span>

      <!-- ValoraciÃ³n: nota sobre 10 + votos abreviados -->
      <span class="badge badge-ghost gap-1">
        <span aria-hidden="true">â˜…</span>
        {{ movie().vote_average | number : '1.1-1' }}
        <span class="opacity-70">({{ movie().vote_count | km : 1 }})</span>
      </span>
    </div>
  </div>

  <!-- GLASS solo si estÃ¡ activa -->
  <div
    class="absolute inset-0 transition-opacity duration-200"
    [class]="isActive() ? 'opacity-100' : 'opacity-0'"
  >
    <div class="glass h-full w-full dark:bg-neutral-900/60 backdrop-blur-md p-4">
      @if (detailsRes.value(); as d) {
      <section class="flex h-full flex-col justify-between">
        <div>
          <p class="text-md font-semibold text-neutral-100 mb-4">
            {{ d.tagline || ' ' }}
          </p>

          <!-- GÃ©neros (badges daisyUI) -->
          @if (d.genres) {
          <div class="mt-3 flex flex-wrap gap-2">
            @for (g of d.genres; track g.id) {
            <span class="badge badge-info badge-sm text-sm">
              {{ g.name }}
            </span>
            }
          </div>
          }
        </div>

        <div class="w-full">
          <div class="flex flex-row justify-between mb-3">
            <button
              class="min-w-[106px] btn btn-outline btn-accent bg-accent/20 w-fit text-neutral-100"
              type="button"
              (click)="toggleWatched($event)"
            >
              <i class="pi" [ngClass]="isInWatched() ? 'pi-eye' : 'pi-eye-slash'"></i>
              <span>{{ isInWatched() ? 'Vista' : 'No vista' }} </span>
            </button>
            <button
              class="btn btn-outline btn-accent bg-accent/20 w-fit text-neutral-100"
              type="button"
              (click)="toggleFavorite($event)"
            >
              <i class="pi" [ngClass]="isInFavorites() ? 'pi-star-fill' : 'pi-star'"></i>
            </button>

            <button
              class="btn btn-outline btn-accent bg-accent/20 w-fit text-neutral-100"
              type="button"
              (click)="toggleList($event)"
            >
              <i class="pi" [ngClass]="isInList() ? 'pi-bookmark-fill' : 'pi-bookmark'"></i>
            </button>
          </div>
          <!-- dentro del GLASS, donde ya tienes el botÃ³n -->
          <button
            class="btn btn-outline btn-accent bg-accent/20 w-full text-neutral-100"
            type="button"
            (click)="goToDetail($event)"
          >
            Ver mÃ¡s
          </button>
          <p class="text-end text-xs opacity-80 text-neutral-100 mt-4">
            Estreno: {{ d.release_date }}
          </p>
        </div>
      </section>
      }
    </div>
  </div>
</div>
